import mini/commands/db;
import mini/forth/init;
import mini/forth/eval;
import mini/types/builtin;

export {
	makeMiniDb(includes : [string], onError : (string) -> void) -> MiniDb;
}

makeMiniDb(includes : [string], onError : (string) -> void) -> MiniDb {
	db = MiniDb(
		includes, 
		makeTree(), 
		MiniDependent(makeTree(), makeTree()),
		makeMiniFileCache(),
		MiniAst(makeTree(), makeTree(), makeTree(), makeTree(), MiniDependent(makeTree(), makeTree()), 
			getBuiltinMiniTypes(), makeTree(), makeTree(), makeTree(), getBuiltinPureNames()),
		makeMiniForth(),
		makeTree(),
		makeTree(),
		makeList(),
		onError
	);

	lib = getFileContent("mini/forth/lib.forth");
	miniEvalForths("", db, strSplit(lib, "\n"))
}
