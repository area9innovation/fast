import mini/mini_command;
import ds/set;
import ds/simplegraph;

export {
	MiniDb(
		// The include path we should use
		includes : [string],
		// The queue of stuff this compiler needs to work on.
		queue : [MiniCommand],

		// The program we are working on - is not consistent yet
		program : MiniAst,

		// This is the evaluation stack for the compiler itself
		stack : List<MiniExp>,

		// TODO: Add a set of outputs we are producing

		// TODO: Add a set of names which have errors. Change this interface accordingly:
		onError : (string) -> void,
	);

	// A consistent set of declarations
	MiniAst(
		// When was this set ready?
		// timestamp : double,
		// The names defined in this program
		declarations : Tree<string, MiniExp>,
		// Where is each name defined? From name to file
		declarationFile : Tree<string, string>,
		// What does this id depend on?
		dependencies : Tree<string, Set<string>>,
		// What depends on this id?
		dependents : Tree<string, Set<string>>,
		// What names are declared in this file?
		// fileDeclarations : Tree<string, [string]>,
		// The types of expressions
		// types : Tree<MiniExp, MiniType>,
		// The dependency graph between names
		// dependency : SimpleGraph<string, bool>,
	);

	pushMiniCommand(db : MiniDb, mini : MiniCommand) -> MiniDb;
}

pushMiniCommand(db : MiniDb, mini : MiniCommand) -> MiniDb {
	MiniDb(db with queue = arrayPush(db.queue, mini));
}
