import mini/exp/ast;
import mini/types/type;
import mini/types/restype;

export {
	// The environment used when doing type inference
	MiniTypeEnv(
		// The program we are typing
		ast : MiniAst,
		// The types of local ids so far
		localTypes : Tree<string, MiniType>,

		// For the MLSub algorithm, we keep track of bounds:
		tyvarLowerBounds : ref Tree<int, Set<MiniType>>,
		tyvarUpperBounds : ref Tree<int, Set<MiniType>>,

		// What is the next tyvar id?
		tyvarId : ref int,

		// What are the tyvars bound to in terms of resolved types?
		// This is set by the resolution
		tyvars : ref Tree<int, MiniType>,

		// We keep a cache of constraints to avoid infinite loops
		constraintCache : ref Set<Pair<MiniType, MiniType>>,

		// What tyvar number does this id start with? Used to map back from tyvars to ids
		tyvar2Id : ref Tree<int, string>,

		// To report errors
		onError : (name : string, pos : int, error : string) -> void,
	);
}
