import ds/array;

export {
	GTerm ::= GRule, GChoice, GSeq, GStar, GPlus, GOpt, GNegate, GUnquote, GString, GRange, GVar;

	GRule(id : string, term : GTerm);
	GChoice(left : GTerm, right : GTerm);
	GSeq(left : GTerm, right : GTerm);
	GStar(term : GTerm);
	GPlus(term : GTerm);
	GOpt(term : GTerm);
	GNegate(term : GTerm);
	GUnquote(term : GTerm);
	GString(text : string);
	GRange(lower : int, upper : int);
	GVar(id : string, power : int);

	gchoices(rt : [GTerm]) -> GTerm;
	gseq(rt : [GTerm]) -> GTerm;
}

gchoices(rt : [GTerm]) -> GTerm {
	t = reverseA(rt);
	fold(tail(t), t[0], \acc, tt -> {
		GChoice(tt, acc)
	})
}

gseq(rt : [GTerm]) -> GTerm {
	t = reverseA(rt);
	fold(tail(t), t[0], \acc, tt -> {
		GSeq(tt, acc)
	})
}
